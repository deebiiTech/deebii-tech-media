<!DOCTYPE html>
<html lang="om">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - Kitaaba Galchi & Mirkaneessi</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
</head>
<body class="bg-slate-900 text-white min-h-screen font-sans">

    <div class="max-w-xl mx-auto py-16 px-6">
        <div class="bg-slate-800 p-8 rounded-sm border-l-8 border-red-700 shadow-2xl mb-10">
            <h2 class="text-3xl font-black uppercase italic mb-8 border-b border-white/10 pb-4">Kitaaba Haaraa Galchi</h2>
            
            <div class="space-y-6">
                <div>
                    <label class="block text-[10px] font-black uppercase mb-2 text-gray-400 tracking-widest">Maqaa Kitaabaa</label>
                    <input type="text" id="title" class="w-full bg-white/5 border border-white/10 p-3 outline-none focus:border-red-700 transition" placeholder="Fkn: Seenaa Jireenyaa">
                </div>

                <div>
                    <label class="block text-[10px] font-black uppercase mb-2 text-gray-400 tracking-widest">Gatii (ETB)</label>
                    <input type="number" id="price" class="w-full bg-white/5 border border-white/10 p-3 outline-none focus:border-red-700 transition" placeholder="100">
                </div>

                <div>
                    <label class="block text-[10px] font-black uppercase mb-2 text-gray-400 tracking-widest">Linkii Suuraa (Imgur)</label>
                    <input type="text" id="imgUrl" class="w-full bg-white/5 border border-white/10 p-3 outline-none focus:border-red-700 transition" placeholder="https://i.imgur.com/example.jpg">
                </div>

                <div>
                    <label class="block text-[10px] font-black uppercase mb-2 text-gray-400 tracking-widest">Linkii PDF (Google Drive)</label>
                    <input type="text" id="pdfUrl" class="w-full bg-white/5 border border-white/10 p-3 outline-none focus:border-red-700 transition" placeholder="https://drive.google.com/...">
                </div>

                <div>
                    <label class="block text-[10px] font-black uppercase mb-2 text-gray-400 tracking-widest">Ibsa Kitaabaa</label>
                    <textarea id="desc" rows="3" class="w-full bg-white/5 border border-white/10 p-3 outline-none focus:border-red-700 transition" placeholder="Waa'ee kitaaba kanaa gabaabsii barreessi..."></textarea>
                </div>

                <button onclick="saveBook()" id="btn" class="w-full bg-red-700 py-4 font-black uppercase hover:bg-white hover:text-black transition duration-500 shadow-lg text-white">
                    Save & Publish
                </button>
            </div>
        </div>

        <div class="bg-slate-800 p-8 rounded-sm border-l-8 border-yellow-600 shadow-2xl">
            <h2 class="text-2xl font-black uppercase italic mb-6 border-b border-white/10 pb-4 text-yellow-500">Kaffaltiiwwan Eeggatan</h2>
            <div id="pendingOrders" class="space-y-4">
                <p class="text-gray-500 text-sm italic">Hamma ammaatti kaffaltiin haaraa hin jiru...</p>
            </div>
        </div>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyA4PdrEH0NAuIWyvl0mP2M3g_L7qNPu8I4",
            authDomain: "deebii-tech-haaraa.firebaseapp.com",
            projectId: "deebii-tech-haaraa",
            appId: "1:521271871630:web:ad10b4227ec94953d161df"
        };

        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }
        const db = firebase.firestore();

        // --- 1. Kitaaba Save Gochuu ---
        function saveBook() {
            const btn = document.getElementById('btn');
            const title = document.getElementById('title').value;
            const price = document.getElementById('price').value;
            const imgUrl = document.getElementById('imgUrl').value;
            const pdfUrl = document.getElementById('pdfUrl').value;
            const desc = document.getElementById('desc').value;

            if(!title || !price || !pdfUrl) {
                alert("Maaloo, Maqaa, Gatii fi Linkii PDF guutuu kee mirkaneessi!");
                return;
            }

            btn.innerText = "Saving...";
            btn.disabled = true;

            db.collection("books").add({
                title: title,
                price: price,
                imgUrl: imgUrl,
                pdfUrl: pdfUrl,
                desc: desc,
                createdAt: firebase.firestore.FieldValue.serverTimestamp()
            })
            .then(() => {
                alert("Kitaabni nagaadhaan dabalameera!");
                window.location.reload();
            })
            .catch((error) => {
                alert("Dogoggora: " + error.message);
                btn.innerText = "Save & Publish";
                btn.disabled = false;
            });
        }

        // --- 2. Kaffaltiiwwan 'Pending' Ta'an Fiduu ---
        db.collection("orders").where("status", "==", "pending")
        .onSnapshot((snapshot) => {
            const container = document.getElementById("pendingOrders");
            if (snapshot.empty) {
                container.innerHTML = '<p class="text-gray-500 text-sm italic">Hamma ammaatti kaffaltiin haaraa hin jiru...</p>';
                return;
            }

            container.innerHTML = ""; 
            snapshot.forEach((doc) => {
                const order = doc.data();
                container.innerHTML += `
                    <div class="bg-black/40 border border-white/10 p-4 rounded-sm shadow-md">
                        <div class="flex justify-between items-start">
                            <div>
                                <h4 class="font-bold text-red-500">${order.bookTitle}</h4>
                                <p class="text-[11px] text-gray-400 mt-1">TxID: <span class="text-white font-mono">${order.transactionId}</span></p>
                                <p class="text-[11px] text-gray-400">Gatii: ${order.price} ETB</p>
                            </div>
                            <button onclick="approveOrder('${doc.id}')" class="bg-green-700 hover:bg-green-600 text-white text-[10px] font-black px-4 py-2 uppercase transition">
                                Approve
                            </button>
                        </div>
                    </div>
                `;
            });
        });

        // --- 3. Kaffaltii Mirkaneessuuf (Approve) ---
        function approveOrder(orderId) {
            if(confirm("Kaffaltii kana baankii keetti galuu isaa mirkaneessiteettaa?")) {
                db.collection("orders").doc(orderId).update({
                    status: "approved"
                }).then(() => {
                    alert("Kaffaltiin mirkanaa'eera! Namichi amma kitaaba buufachuu danda'a.");
                }).catch((err) => {
                    alert("Rakkoo uumame: " + err.message);
                });
            }
        }
    </script>
</body>
</html>
